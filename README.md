# 日本語文難易度制御の疑似パラレルコーパス(公開準備中)
本リポジトリは、「日本語文難易度制御のための疑似パラレル文コーパス構築」および「(B8-3)日本語文平易化のための疑似パラレルコーパス構築」(NLP2025([予稿集リンク](https://www.anlp.jp/proceedings/annual_meeting/2025/)))にて構築した疑似パラレルコーパスを公開するものです。

コーパスの作成手順につきましては上記NLP2025の原稿をご参照ください。

# コーパス概要
日本語文難易度制御の疑似パラレルコーパスは、CC-100から抽出した文からなる文ペアのうち、「意味的類似度が高く、かつ難易度が異なる文ペア」を抽出することを目的としたコーパスです。

後述する難易度測定器の出力難易度のクラス数によってファイルが分かれており、[/datas/pseudo_3class.csv](/datas/pseudo_3class.csv)は3クラスの難易度測定器を、[/datas/pseudo_9class.csv](/datas/pseudo_9class.csv)は9クラスの難易度測定器を使用して作成しています。

各データは、以下のように、各文のテキストと難易度がカンマ区切りで表されています。

`(テキスト1難易度) , (テキスト2難易度) , (テキスト1) , (テキスト2)`

BERTによる文類似度、文の差分のみを用いた差分類似度、難易度測定器による各文の難易度ラベルが付与されています。

類似度および難易度ラベルの測定法はそれぞれ以下の通りです。
## BERT類似度
[東北大学の日本語BERT](https://huggingface.co/tohoku-nlp/bert-base-japanese-whole-word-masking)を用いて文全体の埋め込みを獲得し、そのコサイン類似度を計算したものです。コサイン類似度が0.9以上の文ペアを抽出しています。
## 差分類似度
BERTのみでは、地名などの固有表現のみが異なる文ペアも抽出してしまうことを確認しています。

そのような文ペアは平易化文ペアとすべきではないと判断し、BERTに加えて、文ペアの差分のみの類似度（差分類似度）も測定しました。差分類似度は文字ベースと形態素ベースの2種類を併用し、それぞれ以下の方法で実装しています。 

2種類の差分類似度測定で、ともに値が上位10%であった文ペアを抽出しています。
### 文字ベース差分類似度測定 
差分を文字単位で求め、それを単純に結合した文字列のBERT埋め込みを取得し、コサイン類似度を計算します。 

測定時の流れは以下の通りです。
![文字ベース差分類似度測定概要図](/imgs/diffSim_char.png)

### 形態素ベース差分類似度測定
文をMeCabにより形態素解析し、両文で異なっている形態素のみでアライメントを取り、対応する形態素間の埋め込みの類似度の平均を計算します。 

形態素の埋め込みにはWikipediaで事前学習したFastTextを使用し、アライメントには梶原らの最大アライメントアルゴリズム[梶原ら, 「平易なコーパスを用いないテキスト平易化, 自然言語処理Vol.25, No.2, pp223-249, 2018」](https://www.jstage.jst.go.jp/article/jnlp/25/2/25_223/_pdf/-char/ja)を用いました。

測定時の流れは以下の通りです。
![形態素ベース差分類似度測定概要図](/imgs/diffSim_token.png)
## 難易度測定
難易度測定器として、2種類の分類器を作成し用いました。

以下にそれぞれの測定器の概要を示します。
### 9クラス難易度測定器
このモデルは, 文の難易度を0から8の9段階で測定します(0が最も易しく, 8が最も難しい)。

モデルの学習データにはBCCWJを使用しており、教科書の学年データをもとにBCCWJを難しい順に並び替え、難しい側から9段階に区分したものを日本語BERTのファインチューニングに用いています。

また、9段階の難易度は正規分布に従うように区分されており、中央の難易度4となる文が最も多く、両端へ行くほど数が急激に減少するよう設計されています。 

### 3クラス難易度測定器
[梶原らが作成した単語難易度辞書](https://github.com/Nishihara-Daiki/lsj?tab=readme-ov-file#%E5%B9%B3%E6%98%93%E3%81%AA%E8%A8%80%E3%81%84%E6%8F%9B%E3%81%88%E8%BE%9E%E6%9B%B8)を用いて、文の難易度を初級・中級・上級に分類します。

難易度測定器の訓練データ作成のため、辞書に基づき、以下のように文に難易度ラベルを付与するルールを設定しました。
- 上級単語を含む文を「上級文」とする。
- 中級単語を含むが上級単語を含まない文を「中級文」とする。
- 初級単語を含むが中級単語・上級単語を含まない文を「初級文」とする。
- 文中に単語難易度辞書の語彙が1つもなかった場合は「測定不能」として学習データには含めない。
- 
上記ルールに従い、BCCWJの文3,685,215文に文ラベルを付与しました。付与したラベルの分布は以下の通りです。
| 難易度  | 文数 |
| ------------- | -------------: |
| 上級  | 2,761,218  |
| 中級  | 799,474  |
| 初級  | 99,917  |
| ラベル無し  | 24,606  |
| 計  | 3,685,215  |

ラベル無しのデータは除外し、文数に偏りがあるため、初級文の文数99,917文にアンダーサンプリングしたものを学習データとしてBERTをファインチューニングしました。
 
# ライセンス
This project is licensed under the MIT License, see the LICENSE.txt file for details

なお、本実験では次のリソースを使用しています。
- [現代日本語書き言葉均衡コーパス　教科書サブコーパス](https://clrd.ninjal.ac.jp/bccwj/)
- [Lexical Simplification Japanese_単語難易度辞書](https://github.com/Nishihara-Daiki/lsj?tab=readme-ov-file#%E5%B9%B3%E6%98%93%E3%81%AA%E8%A8%80%E3%81%84%E6%8F%9B%E3%81%88%E8%BE%9E%E6%9B%B8)
- [CC-100](https://data.statmt.org/cc-100/)
